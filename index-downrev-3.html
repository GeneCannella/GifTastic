<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>GifTastic</title>
    <style type="text/css">
    button,
    div,
    form,
    input {
        margin: 10px;
    }
    </style>
    <style type="text/css">
    .topicDiv {
        float: left;
    }
    </style>
</head>

<body>
    <div class="container">
        <!-- Input Form for GIPHY topics -->
        <h1>GIPHY Search</h1>
        <!-- Rendered Buttons will be placed here  -->
        <div id="rendered-buttons">Rendered buttons go here</div>
        <form id="topic-entry-form">
            <label for="topic-input">Enter New Topic</label>
            <input type="text" id="topic-input">
            <br>
            <!-- Button triggers new movie to be added -->
            <input id="add-topic" type="submit" value="Submit">
        </form>
        <!-- GIPHY reults will be placed here -->
        <div id="giphy-results"></div>
    </div>
    <!--Link to jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Psuedo Code 
    1. We need an event handler that listens for button clicks and hits the GIPHY API for that topic
    1.1. grab the "topic" value from the button that was clicked
    1.2  construct a queryURL using the topic value
    1.3. do an AJAX request with that queryURL
    2. We need an event handler that listens for the submit button used to create a new topic button
    2.1. grab the form input
    2.2. push the result onto the topics array
    2.3. re-render all the buttons based on the new array
    3. We need a click handler that listens for clicks on the gifs and toggles the state of still/animated


    -->
    <!--begin script for dynamic elements using giphy app -->
    <!-- -->
    <script type="text/javascript">
    //
    //
    var topics = ["Einstein", "Isaac Newton", "Isaac Asimov", "Stephen Hawking"];


    // (1.) Here is the event handler that listens for button clicks and hits the GIPHY API for that topic
    // Adding a click event listener to all elements with a class of "button"
    $(document).on("click", ".button", function() {

        // Grabbing and storing the data-topic property value from the button
        var topic = $(this).attr("data-topic");

        // Constructing a queryURL using the topic from the clicked button
        var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
            topic + "&api_key=dc6zaTOxFJmzC&limit=10";

        // Performing an AJAX request with the queryURL
        $.ajax({
                url: queryURL,
                method: "GET"
            })
            // After data comes back from the request
            .done(function(response) {

                console.log("queryURL= ", queryURL);
                console.log("response= ", response);

                // storing the data from the AJAX request in the results variable
                var results = response.data;

                $("#giphy-results").empty();

                // Looping through each result item
                for (var i = 0; i < results.length; i++) {

                    // Creating and storing a div tag
                    var topicDiv = $("<div>");

                    // Creating a paragraph tag with the result item's rating
                    var p = $("<p>").text("Rating: " + results[i].rating);

                    // Creating and storing an image tag
                    var topicImage = $("<img>");

                    //figure out why I can't get at the native html with any of these construction
                    //console.log("create img element");
                    //console.log(topicImage);
                    //console.log("of [0]", topicImage[0]);
                    //console.log(topicImage.html());


                    // Set the img src attribute the url for the (still) image, retrieved from the results object
                    topicImage.attr("src", results[i].images.fixed_height_still.url); //uses the still image
                    //topicImage.attr("src", results[i].images.fixed_height.url); //uses the animated image

                    //now we need to add data-still and data-animate attributes to the img for the still and animated src files
                    topicImage.attr("data-still", results[i].images.fixed_height_still.url);
                    topicImage.attr("data-animate", results[i].images.fixed_height.url);

                    //also need to add data-state attribute, initialized to still
                    topicImage.attr("data-state", "still");

                    //add a class we can use select the images later for a click function
                    topicImage.addClass("gif");

                    // Appending the paragraph and image tag to the topicDiv
                    topicDiv.append(p);
                    topicDiv.append(topicImage);
                    topicDiv.addClass("topicDiv"); //adding this class so we can style the image divs (first pass style is float: left)

                    // Appendng the topicDiv to the HTML page in the "#giphy-results" div
                    $("#giphy-results").append(topicDiv);
                }
            });

        console.log("gif html");
        console.log($(".gif").html());
    });

    // (2.) Here is the event handler that listens for the submit button used to create a new topic button
    $("#add-topic").on("click", function(event) {
        event.preventDefault();
        // This line grabs the input from the textbox
        var topic = $("#topic-input").val().trim();
        // Adding movie from the textbox to our array
        topics.push(topic);
        // Calling renderButtons which handles the processing of our movie array
        renderTopicButtons();
        console.log("gif html");
        console.log($(".gif").html());
    });

    // (3.) Here is the click handler for animating the gifs 
//    $(".gif").on("click", function() {
//    $(".topicDiv").on("click", function() {
    $(document).on("click", ".gif", function() {
        console.log("gif has been clicked");
        // The attr jQuery method allows us to get or set the value of any attribute on our HTML element
        var state = $(this).attr("data-state");
        console.log("data-state= ", state);
        // If the clicked image's state is still, update its src attribute to what its data-animate value is.
        // Then, set the image's data-state to animate
        // Else set src to the data-still value
        if (state === "still") {
            $(this).attr("src", $(this).attr("data-animate"));
            $(this).attr("data-state", "animate");
        } else {
            $(this).attr("src", $(this).attr("data-still"));
            $(this).attr("data-state", "still");
        }
    });

    function renderTopicButtons() {
        // Deleting the movies prior to adding new movies
        // (this is necessary otherwise you will have repeat buttons)
        $("#rendered-buttons").empty();
        // Looping through the array of movies
        for (var i = 0; i < topics.length; i++) {
            // Then dynamicaly generating buttons for each movie in the array
            // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
            var a = $("<button>");
            // Adding a class of movie to our button
            a.addClass("button");
            // Adding a data-attribute
            a.attr("data-topic", topics[i]);
            // Providing the initial button text
            a.text(topics[i]);
            // Adding the button to the buttons-view div
            $("#rendered-buttons").append(a);
        }
    }

    renderTopicButtons();
    //
    //
    //
    </script>
</body>

</html>
<!-- Remaining to do
    Add still/anaimate functionality
    move js to separate file
    add some styling, perhaps bootstrap