<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>GifTastic</title>
    <style type="text/css">
    button,
    div,
    form,
    input {
        margin: 10px;
    }
    </style>
</head>

<body>
    <div class="container">
        <h1>Movie Search</h1>
        <!-- Movies will Get Dumped Dere -->
        <div id="movies-view"></div>
        <!-- Rendered Buttons will get Dumped Here  -->
        <div id="buttons-view"></div>
        <form id="movie-form">
            <label for="movie-input">Add a Movie Bro</label>
            <input type="text" id="movie-input">
            <br>
            <!-- Button triggers new movie to be added -->
            <input id="add-movie" type="submit" value="Add a Movie Bro">
        </form>
        <!--End complete movie app, begin dynamic elements-->
        <button class="button" data-topic="scientist" data-animal="cat">scientist</button>
        <button class="button" data-animal="dog">woof</button>
        <button class="button" data-animal="bird">chirp</button>
        <div id="gifs-appear-here"></div>
        <!-- Input Form for GIPHY topics -->
        <h1>GIPHY Search</h1>
        <!-- GIPHY reults will be placed here -->
        <div id="giphy-results"></div>
        <!-- Rendered Buttons will be placed here  -->
        <div id="rendered-buttons">Rendered buttons go here</div>
        <form id="topic-entry-form">
            <label for="topic-input">Enter New Topic</label>
            <input type="text" id="topic-input">
            <br>
            <!-- Button triggers new movie to be added -->
            <input id="add-topic" type="submit" value="Submit">
        </form>
    </div>
    <!--Link to jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Psuedo Code 
    1. We need an event handler that listens for button clicks and hits the GIPHY API for that topic
    1.1. grab the "topic" value from the button that was clicked
    1.2  construct a queryURL using the topic value
    1.3. do an AJAX request with that queryURL
    2. We need an event handler that listens for the submit button used to create a new topic button
    2.1. grab the form input
    2.2. push the result onto the topics array
    2.3. re-render all the buttons based on the new array


    -->
    <!--begin script for dynamic elements using giphy app -->
    <!-- -->
    <script type="text/javascript">
    //
    //
    var topics = ["Einstein", "Isaac Newton", "Isaac Asimov", "Scientists"];


    // (1.) Here is the event handler that listens for button clicks and hits the GIPHY API for that topic
    // Adding a click event listener to all elements with a class of "button"
    $(document).on("click", ".button", function() {


        // Adding click event listen listener to all buttons - deprecated
        //$("button").on("click", function() {


        // Grabbing and storing the data-topic property value from the button
        var topic = $(this).attr("data-topic");

        // Constructing a queryURL using the topic from the clicked button
        var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
            topic + "&api_key=dc6zaTOxFJmzC&limit=10";

        // Performing an AJAX request with the queryURL
        $.ajax({
                url: queryURL,
                method: "GET"
            })
            // After data comes back from the request
            .done(function(response) {
                console.log(queryURL);

                console.log(response);
                // storing the data from the AJAX request in the results variable
                var results = response.data;

                // Looping through each result item
                for (var i = 0; i < results.length; i++) {

                    // Creating and storing a div tag
                    var topicDiv = $("<div>");

                    // Creating a paragraph tag with the result item's rating
                    var p = $("<p>").text("Rating: " + results[i].rating);

                    // Creating and storing an image tag
                    var topicImage = $("<img>");
                    // Setting the src attribute of the image to a property pulled off the result item
                    topicImage.attr("src", results[i].images.fixed_height.url);

                    // Appending the paragraph and image tag to the animalDiv
                    topicDiv.append(p);
                    topicDiv.append(topicImage);

                    // Prependng the animalDiv to the HTML page in the "#gifs-appear-here" div
                    $("#gifs-appear-here").prepend(topicDiv);
                }
            });
    });

    //(2.) Here is the event handler that listens for the submit button used to create a new topic button
    $("#add-topic").on("click", function(event) {
        event.preventDefault();
        // This line grabs the input from the textbox
        var topic = $("#topic-input").val().trim();
        // Adding movie from the textbox to our array
        topics.push(topic);
        // Calling renderButtons which handles the processing of our movie array
        renderTopicButtons();
    });

    function renderTopicButtons() {
        // Deleting the movies prior to adding new movies
        // (this is necessary otherwise you will have repeat buttons)
        $("#rendered-buttons").empty();
        // Looping through the array of movies
        for (var i = 0; i < topics.length; i++) {
            // Then dynamicaly generating buttons for each movie in the array
            // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
            var a = $("<button>");
            // Adding a class of movie to our button
            a.addClass("button");
            // Adding a data-attribute
            a.attr("data-topic", topics[i]);
            // Providing the initial button text
            a.text(topics[i]);
            // Adding the button to the buttons-view div
            $("#rendered-buttons").append(a);
        }
    }

    renderTopicButtons();
    //
    //
    //
    </script>
    <!--begin script for movie app -->
    <script type="text/javascript">
    // Initial array of movies
    var movies = ["The Matrix", "The Notebook", "Mr. Nobody", "The Lion King"];
    // displayMovieInfo function re-renders the HTML to display the appropriate content
    function displayMovieInfo() {
        var movie = $(this).attr("data-name");
        var queryURL = "https://www.omdbapi.com/?t=" + movie + "&y=&plot=short&apikey=trilogy";
        // Creating an AJAX call for the specific movie button being clicked
        $.ajax({
            url: queryURL,
            method: "GET"
        }).done(function(response) {
            // Creating a div to hold the movie
            var movieDiv = $("<div class='movie'>");
            // Storing the rating data
            var rating = response.Rated;
            // Creating an element to have the rating displayed
            var pOne = $("<p>").text("Rating: " + rating);
            // Displaying the rating
            movieDiv.append(pOne);
            // Storing the release year
            var released = response.Released;
            // Creating an element to hold the release year
            var pTwo = $("<p>").text("Released: " + released);
            // Displaying the release year
            movieDiv.append(pTwo);
            // Storing the plot
            var plot = response.Plot;
            // Creating an element to hold the plot
            var pThree = $("<p>").text("Plot: " + plot);
            // Appending the plot
            movieDiv.append(pThree);
            // Retrieving the URL for the image
            var imgURL = response.Poster;
            // Creating an element to hold the image
            var image = $("<img>").attr("src", imgURL);
            // Appending the image
            movieDiv.append(image);
            // Putting the entire movie above the previous movies
            $("#movies-view").prepend(movieDiv);
        });
    }
    // Function for displaying movie data
    function renderButtons() {
        // Deleting the movies prior to adding new movies
        // (this is necessary otherwise you will have repeat buttons)
        $("#buttons-view").empty();
        // Looping through the array of movies
        for (var i = 0; i < movies.length; i++) {
            // Then dynamicaly generating buttons for each movie in the array
            // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
            var a = $("<button>");
            // Adding a class of movie to our button
            a.addClass("movie");
            // Adding a data-attribute
            a.attr("data-name", movies[i]);
            // Providing the initial button text
            a.text(movies[i]);
            // Adding the button to the buttons-view div
            $("#buttons-view").append(a);
        }
    }
    // This function handles events where add movie button is clicked
    $("#add-movie").on("click", function(event) {
        event.preventDefault();
        // This line grabs the input from the textbox
        var movie = $("#movie-input").val().trim();
        // Adding movie from the textbox to our array
        movies.push(movie);
        // Calling renderButtons which handles the processing of our movie array
        renderButtons();
    });
    // Adding a click event listener to all elements with a class of "movie"

    $(document).on("click", ".movie", displayMovieInfo); //no longer need this
    // Calling the renderButtons function to display the intial buttons
    renderButtons();
    </script>
</body>

</html>